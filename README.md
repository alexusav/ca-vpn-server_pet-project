# ca-vpn-server_pet-project –ü–≠–¢ –ø—Ä–æ–µ–∫—Ç

## üìã –û –ø—Ä–æ–µ–∫—Ç–µ

–ü–µ—Ç-–ø—Ä–æ–µ–∫—Ç. –ù–µ–±–æ–ª—å—à–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∫ —É–¥–∞–ª–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º —Å –ø–æ–º–æ—â—å—é VPN. –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å, –Ω–∞—É—á–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑—Ç—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–æ—Ä–∞—Ü–∏–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 3—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤.
- CA server. –°–µ—Ä–≤–µ—Ä —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –≤—ã–¥–∞—á–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
- VPN server. –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π —Å–µ—Ç–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è.
- Monitoring server. –°–µ—Ä–≤–µ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –æ–±–ª–∞—á–Ω–∞—è —Å—Ä–µ–¥–∞ –æ—Ç Yandex Cloud.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º –∞–∫–∫–∞—É–Ω—Ç –≤ –æ–±–ª–∞—á–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ.
- –ù–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ubuntu server.
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ IP –∞–¥—Ä–µ—Å–∞.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

#### –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã —Å –Ω–∞–∏–º–µ–Ω–Ω–µ–µ –∑–∞—Ç—Ä–∞—Ç–Ω—ã–º —Ç–∞—Ä–∏—Ñ–æ–º, –∏—Å–ø–æ–ª—å–∑—É—è CLI yandex cloud:

```bash
# –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ Windows
  yc compute instance create ^
  --name <instance-name> ^
  --network-interface subnet-id=<subnet id>,nat-ip-version=ipv4 ^
  --zone ru-central1-d ^
  --preemptible ^
  --platform standard-v3 ^
  --memory 2 ^
  --cores 2 ^
  --core-fraction 20 ^
  --create-boot-disk image-folder-id=standard-images,image-id=fd8vh7l8lcb182vm5vfd,size=20,type=network-hdd ^
  --hostname <instance-name> ^
  --ssh-key C:\Users\<username>\.ssh\id_ed25519.pub
```
- –î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É, –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –Ω–µ–π –ø–æ SSH –∏—Å–ø–æ–ª—å–∑—É—è –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π SSH-–∫–ª—é—á.
- –ü–µ—Ä–µ–¥–∞—Ç—å –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É —Å–∫—Ä–∏–ø—Ç first-config.sh –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å. –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ - ca-server, –∏ —Ç.–¥. 
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç first-config.sh —Å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏, –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

  –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Ç–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –∫–∞–∫:
  - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
  - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ssh, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –ø–æ—Ä—Ç–∞ –Ω–∞ 2222**
  - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ iptables

 > –î–∞–Ω–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã! –í—Å—è –¥–∞–ª—å–Ω–µ–π—à–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤—Ä–µ—Ä–∞. 


#
#### CA server. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
#

**–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞:**

**1. –í–∞—Ä–∏–∞–Ω—Ç** –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–∞–∫–µ—Ç–∞ ca-server/easy-rsa-ca-server_0.1-1_all.deb –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. 
```
cd /var/easy-rsa
bash /var/easy-rsa/easyrsa build-ca
```
–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥, —ç—Ç–æ –≤—ã–ø—É—Å–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞:
```
cd /var/easy-rsa
bash /var/easy-rsa/easyrsa gen-req <CompanyName> nopass
#–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ req —Ñ–∞–π–ª–∞
bash /var/easy-rsa/easyrsa sign-req server <CompanyName>
```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –ø–æ–ª—É—á–∞–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /var/easy-rsa/pki/ –ø—É–±–ª–∏—á–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ca.crt  <br> –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /var/easy-rsa/pki/issued –ø—É–±–ª–∏—á–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ \<CompanyName\>.crt  <br>  –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /var/easy-rsa/pki/private –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ \<CompanyName\>.key

**2. –í–∞—Ä–∏–∞–Ω—Ç** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç ca-server/ca-config.sh, –∫–æ—Ç–æ—Ä—ã–π —É—Å—Ç–∞–Ω–æ–≤–∏—Ç easy-rsa –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –ø–æ–ª—É—á–∞–µ–º –≥–æ—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ **/var/easy-rsa**  <br>  –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:
```
cd /var/easy-rsa
bash /var/easy-rsa/easyrsa gen-req <ClientName> nopass
#–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ req —Ñ–∞–π–ª–∞
bash /var/easy-rsa/easyrsa sign-req client <ClientName>
```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∞–µ–º: <br> /var/easy-rsa/pki/issued/\<ClientName\>.crt <br> /var/easy-rsa/pki/private/\<ClientName\>.key

–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞ VPN —Å–µ—Ä–≤–µ—Ä.


#
#### VPN server. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ VPN —Å–µ—Ä–≤–µ—Ä–∞ 
#

–¢–∞–∫–∂–µ –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞.

**1. –í–∞—Ä–∏–∞–Ω—Ç** –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–∞–∫–µ—Ç–∞ vpn-server/openvpn-vpn-server_2.6.14-0ubuntu0.25.04.2_amd64.deb –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.

**2. –í–∞—Ä–∏–∞–Ω—Ç** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç vpn-server/vpn-server-config.sh 


–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã ca.crt, \<CompanyName\>.crt (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ server.crt), \<CompanyName\>.key (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ server.key) –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /etc/openvpn/server/

–î–∞–ª–µ–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å tls-crypt-v2 –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É:
```
cd /etc/openvpn/server/
sudo openvpn --genkey --secret ta.key
```
–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä VPN –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –ß—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—ã–¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä–æ–º CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /etc/openvpn/client –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏–∑ —ç—Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –ø–µ—Ä–µ–¥–∞–≤ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞):
```
sudo /etc/openvpn/client/make_config.sh <ClientName>
```

–ü–æ–ª—É—á–∞–µ–º –≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª /etc/openvpn/client/\<ClientName\>.ovpn <br>
–≠—Ç–æ—Ç —Ñ–∞–π–ª –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤—Ä—É VPN.

#
#### Monitoring server. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ Monitoring —Å–µ—Ä–≤–µ—Ä–∞ 
#

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç monitoring-server/mon-config.sh
–ö–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏–∑–≤–µ–¥–µ—Ç –¥–æ–Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ä–≤–µ—Ä–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã —Å –≥–æ—Ç–æ–≤—ã–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏: 
prometheus-2.31.2.1+ds1_1ubuntu1.22.04.3-1_all.deb
prometheus-nginx-exporter-0.10.0_1ubuntu0.1-1_all.deb

–ü–æ—Å–ª–µ —É—Å—Ç–Ω–æ–≤–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /etc/prometheus/ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ ca.crt,
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ \<CompanyName\>.crt,
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ \<CompanyName\>.key
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ \<CompanyName\>.crt,
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ VPN \<CompanyName\>.crt
  
–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –∑–∞ –¥–∞–Ω–Ω—ã–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

**–ù–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–ø–∏—Å–∞—Ç—å –≤ /etc/hosts –∏–º–µ–Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤—Ä–µ—Ä–æ–≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.**
**–£—Å—Ç–Ω–æ–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä CA –ø–∞–∫–µ—Ç prometheus-node-exporter-ca-1.3.1_1ubuntu0.22.04.3-1_all.deb**
**–£—Å—Ç–Ω–æ–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä VPN –ø–∞–∫–µ—Ç prometheus-node-exporter-vpn-1.3.1_1ubuntu0.22.04.3-1_all.deb –∏ prometheus-openvpn-exporter_0.3.0-1_all.deb**

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ exporter –Ω–∞ CA –∏ VPN —Å–µ—Ä–≤–µ—Ä–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /opt/node_exporter —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:

**CA —Å–µ—Ä–≤–µ—Ä:**
- ca.\<CompanyName\>.crt 
- ca.\<CompanyName\>.key
  
**VPN —Å–µ—Ä–≤–µ—Ä:**
- vpn.\<CompanyName\>.crt
- vpn.\<CompanyName\>.key

#
#### Backup server. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ Backup —Å–µ—Ä–≤–µ—Ä–∞
#

–°–µ—Ä–≤–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–æ–ª—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –≤–∞–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤.
–î–ª—è —Ä–∞–±–æ—Ç—ã c —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∫–ª—é—á–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç backup-server/confifure_ssh.sh –Ω–∞ –∫–∞–∂–¥–æ–º –∏–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª—é—á–∏. –°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Backup —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ñ–∞–π–ª ~/.ssh/authorized_keys.
–ù–∞ —ç—Ç–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞.

–û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ backup-server –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏—é –Ω–∞ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /usr/local/bin/ –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ CRON –∑–∞–¥–∞—á—É: 
```
0 2 * * * /usr/local/bin/NAME-create-backup.sh >> /var/log/backup.log 2>&1
```

–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –¥—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã, –∞ –∑–∞—Ç–µ–º –∫–æ–ø–∏—Ä—É–µ—Ç –∏—Ö –Ω–∞ Backup —Å–µ—Ä–≤–µ—Ä. –¢–∞–∫ –∂–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞ —Ä–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–ø–∏–π –Ω–µ —Å—Ç–∞—Ä—à–µ –Ω–µ–¥–µ–ª–∏.

–ò–∑ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å —Ç–∞–∫–∏–µ –ø—É–Ω–∫—Ç—ã:
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —Å –ø–æ–º–æ—â—å—é GPG (AES256)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É


##### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–µ–ª–∏–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞ backup-server/restore-backup.sh

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä –±—ç–∫–∞–ø–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ - —Å–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±—ç–∫–∞–ø–µ –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ - —Ç–æ—á–µ—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤


–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
```
--list - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
--inspect - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –±—ç–∫–∞–ø–∞
--file - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
–ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```
# –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
./restore_script.sh --list

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—ç–∫–∞–ø–∞
./restore_script.sh --inspect backup_20231201_120000.tar.gz.gpg

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
./restore_script.sh --file backup_20231201_120000.tar.gz.gpg /etc/ssh/sshd_config

# –ü–æ–ª–Ω–æ–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
./restore_script.sh
```


#


#


#
- —Å–æ—Å—Ç–∞–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞, 
- —Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤/—Å–µ—Ä–≤–µ—Ä–æ–≤, 
- –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, 
- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.
