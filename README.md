# ca-vpn-server_pet-project
first pet project
—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ, 
–∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã/—É—Ç–∏–ª–∏—Ç—ã/–ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ, 
–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç,
—Å–æ—Å—Ç–∞–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞, 
—Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤/—Å–µ—Ä–≤–µ—Ä–æ–≤, 
–æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, 
–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.


## üìã –û –ø—Ä–æ–µ–∫—Ç–µ

–ü–µ—Ç-–ø—Ä–æ–µ–∫—Ç. –ù–µ–±–æ–ª—å—à–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∫ —É–¥–∞–ª–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º —Å –ø–æ–º–æ—â—å—é VPN. –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å, –Ω–∞—É—á–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑—Ç—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–æ—Ä–∞—Ü–∏–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 3—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤.
- CA server. –°–µ—Ä–≤–µ—Ä —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –≤—ã–¥–∞—á–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
- VPN server. –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π —Å–µ—Ç–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è.
- Monitoring server. –°–µ—Ä–≤–µ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –æ–±–ª–∞—á–Ω–∞—è —Å—Ä–µ–¥–∞ –æ—Ç Yandex Cloud.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º –∞–∫–∫–∞—É–Ω—Ç –≤ –æ–±–ª–∞—á–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ.
- –ù–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ubuntu server.
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ IP –∞–¥—Ä–µ—Å–∞.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

#### –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã —Å –Ω–∞–∏–º–µ–Ω–Ω–µ–µ –∑–∞—Ç—Ä–∞—Ç–Ω—ã–º —Ç–∞—Ä–∏—Ñ–æ–º, –∏—Å–ø–æ–ª—å–∑—É—è CLI yandex cloud:

```bash
# –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ Windows
  yc compute instance create ^
  --name <instance-name> ^
  --network-interface subnet-id=<subnet id>,nat-ip-version=ipv4 ^
  --zone ru-central1-d ^
  --preemptible ^
  --platform standard-v3 ^
  --memory 2 ^
  --cores 2 ^
  --core-fraction 20 ^
  --create-boot-disk image-folder-id=standard-images,image-id=fd8vh7l8lcb182vm5vfd,size=20,type=network-hdd ^
  --hostname <instance-name> ^
  --ssh-key C:\Users\<username>\.ssh\id_ed25519.pub
```


#### CA server. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

- –î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É, –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –Ω–µ–π –ø–æ SSH –∏—Å–ø–æ–ª—å–∑—É—è –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.
- –ü–µ—Ä–µ–¥–∞—Ç—å –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É —Å–∫—Ä–∏–ø—Ç first-config.sh –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ ca-server.
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç first-config.sh —Å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏, –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

  –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Ç–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –∫–∞–∫:
  - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
  - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ssh, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –ø–æ—Ä—Ç–∞ –Ω–∞ 2222**
  - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ iptables
 
**–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞:**

**1. –í–∞—Ä–∏–∞–Ω—Ç** –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–∞–∫–µ—Ç–∞ ca-server/easy-rsa-ca-server_0.1-1_all.deb –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. 
```
cd /var/easy-rsa
bash /var/easy-rsa/easyrsa build-ca
```
–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥, —ç—Ç–æ –≤—ã–ø—É—Å–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞:
```
cd /var/easy-rsa
bash /var/easy-rsa/easyrsa gen-req <CompanyName> nopass
#–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ req —Ñ–∞–π–ª–∞
bash /var/easy-rsa/easyrsa sign-req server <CompanyName>
```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –ø–æ–ª—É—á–∞–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /var/easy-rsa/pki/ –ø—É–±–ª–∏—á–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ca.crt  <br> –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /var/easy-rsa/pki/issued –ø—É–±–ª–∏—á–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ <CompanyName>.crt  <br>  –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /var/easy-rsa/pki/private –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ <CompanyName>.key

**2. –í–∞—Ä–∏–∞–Ω—Ç** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç ca-server/ca-config.sh, –∫–æ—Ç–æ—Ä—ã–π —É—Å—Ç–∞–Ω–æ–≤–∏—Ç easy-rsa –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –ø–æ–ª—É—á–∞–µ–º –≥–æ—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ **/var/easy-rsa**  <br>  –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:
```
cd /var/easy-rsa
bash /var/easy-rsa/easyrsa gen-req <ClientName> nopass
#–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ req —Ñ–∞–π–ª–∞
bash /var/easy-rsa/easyrsa sign-req client <ClientName>
```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∞–µ–º: <br> /var/easy-rsa/pki/issued/<ClientName>.crt <br> /var/easy-rsa/pki/private/<ClientName>.key

–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞ VPN —Å–µ—Ä–≤–µ—Ä.


#### VPN server. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ VPN —Å–µ—Ä–≤–µ—Ä–∞ 


```bash

```
